{% extends "base.html" %}

{% block title %}{{ product.name }} - Ayurshop{% endblock %}
{% block bottom_nav %}{% endblock %}

{% block content %}

<style>
    /* ===============================================
       PREMIUM PRODUCT PAGE DESIGN
       =============================================== */
    
    :root {
        --primary-green: #2d6a4f;
        --primary-green-light: #52b788;
        --primary-green-dark: #1b4332;
        --accent: #95d5b2;
        --primary-blue: #2563eb;
        --primary-blue-dark: #1d4ed8;
        --text-dark: #111827;
        --text-medium: #374151;
        --text-gray: #6b7280;
        --text-light: #9ca3af;
        --border-light: #e5e7eb;
        --bg-light: #f9fafb;
        --bg-white: #ffffff;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --glow: 0 0 40px rgba(82, 183, 136, 0.15);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-fast: all 0.15s ease;
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 20px;
    }

    * { 
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        color: var(--text-dark);
        line-height: 1.6;
        background: var(--bg-light);
        overflow-x: hidden;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 16px;
        position: relative;
    }

    /* ===============================================
       LOADING SKELETON
       =============================================== */
    
    .skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: var(--radius-sm);
    }

    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    /* ===============================================
       HEADER SECTION
       =============================================== */
    
    .product-header { 
        margin: 24px 0 32px;
        padding: 0 0 24px;
        border-bottom: 1px solid var(--border-light);
        animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text-gray);
        margin-bottom: 16px;
    }

    .breadcrumb a {
        color: var(--text-gray);
        text-decoration: none;
        transition: var(--transition-fast);
    }

    .breadcrumb a:hover {
        color: var(--primary-green);
    }

    .breadcrumb .separator {
        color: var(--text-light);
        font-size: 12px;
    }

    .product-title-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 24px;
        margin-bottom: 16px;
    }

    .product-title {
        font-size: 28px;
        font-weight: 800;
        color: var(--text-dark);
        line-height: 1.2;
        letter-spacing: -0.01em;
        flex: 1;
    }

    .wishlist-btn {
        background: none;
        border: 1.5px solid var(--border-light);
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
        flex-shrink: 0;
    }

    .wishlist-btn:hover {
        border-color: var(--primary-green);
        background: rgba(82, 183, 136, 0.05);
        transform: scale(1.05);
    }

    .wishlist-btn.active svg {
        fill: #ef4444;
        stroke: #ef4444;
    }

    .wishlist-btn svg {
        width: 24px;
        height: 24px;
        stroke: var(--text-gray);
        fill: none;
        transition: var(--transition);
    }

    .product-meta {
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .brand-tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--primary-green);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 700;
        padding: 8px 16px;
        background: linear-gradient(135deg, rgba(82, 183, 136, 0.08) 0%, rgba(45, 106, 79, 0.05) 100%);
        border-radius: var(--radius-lg);
        transition: var(--transition);
        border: 1.5px solid rgba(82, 183, 136, 0.2);
    }

    .brand-tag:hover {
        background: linear-gradient(135deg, rgba(82, 183, 136, 0.15) 0%, rgba(45, 106, 79, 0.1) 100%);
        transform: translateY(-1px);
        border-color: rgba(82, 183, 136, 0.4);
    }

    .rating-section {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        background: var(--bg-white);
        border-radius: var(--radius-lg);
        border: 1.5px solid var(--border-light);
        transition: var(--transition);
    }

    .rating-section:hover {
        border-color: #f59e0b;
        box-shadow: var(--shadow-sm);
    }

    .stars { 
        color: #f59e0b;
        font-size: 16px;
        letter-spacing: 1px;
        position: relative;
    }

    .stars::before {
        content: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
        color: #e5e7eb;
    }

    .stars-inner {
        position: absolute;
        top: 0;
        left: 0;
        white-space: nowrap;
        overflow: hidden;
        width: calc(var(--rating, 0) * 20%);
    }

    .rating-text { 
        font-size: 15px;
        font-weight: 700;
        color: var(--text-dark);
    }

    .review-count { 
        font-size: 14px;
        color: var(--text-gray);
        cursor: pointer;
        font-weight: 500;
        transition: var(--transition-fast);
        text-decoration: none;
    }

    .review-count:hover {
        color: var(--primary-blue);
        text-decoration: underline;
    }

    /* ===============================================
       MAIN CONTAINER
       =============================================== */

    .product-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 32px;
        margin-bottom: 48px;
    }

    /* ===============================================
       IMAGE GALLERY
       =============================================== */

    .image-gallery {
        position: relative;
        animation: slideInLeft 0.6s ease-out;
    }

    @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    .main-image-wrapper {
        position: relative;
        width: 100%;
        border-radius: var(--radius-xl);
        overflow: hidden;
        background: var(--bg-white);
        box-shadow: var(--shadow-md);
        margin-bottom: 16px;
        border: 1px solid var(--border-light);
    }

    .main-image-container {
        position: relative;
        width: 100%;
        aspect-ratio: 1 / 1;
        background: linear-gradient(135deg, #f8fafc 0%, #f0f7f4 100%);
    }

    .main-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        padding: 32px;
        background: transparent;
        transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: zoom-in;
    }

    .main-image.zoomed {
        transform: scale(1.5);
        cursor: zoom-out;
    }

    .image-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #f8fafc 0%, #f0f7f4 100%);
        color: var(--text-gray);
        font-size: 14px;
    }

    .image-placeholder svg {
        width: 64px;
        height: 64px;
        stroke: var(--border-light);
        margin-bottom: 16px;
    }

    /* Navigation Arrows */
    .nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: var(--bg-white);
        border: 1.5px solid var(--border-light);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: var(--transition);
        box-shadow: var(--shadow-md);
        backdrop-filter: blur(8px);
    }

    .nav-arrow:focus-visible {
        outline: 3px solid var(--primary-blue);
        outline-offset: 2px;
    }

    .nav-arrow:hover:not(.disabled) {
        background: var(--primary-green);
        border-color: var(--primary-green);
        box-shadow: var(--shadow-lg), 0 0 20px rgba(82, 183, 136, 0.3);
        transform: translateY(-50%) scale(1.05);
    }

    .nav-arrow:hover:not(.disabled) svg {
        stroke: white;
    }

    .nav-arrow.disabled {
        opacity: 0.3;
        cursor: not-allowed;
        pointer-events: none;
    }

    .nav-arrow-left {
        left: 16px;
    }

    .nav-arrow-right {
        right: 16px;
    }

    .nav-arrow svg {
        width: 20px;
        height: 20px;
        stroke: var(--text-dark);
        stroke-width: 2.5;
        fill: none;
        transition: var(--transition);
    }

    /* Image Counter */
    .image-counter {
        position: absolute;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 16px;
        border-radius: var(--radius-lg);
        font-size: 13px;
        font-weight: 600;
        backdrop-filter: blur(8px);
        z-index: 10;
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(255, 255, 255, 0.1);
        pointer-events: none;
    }

    /* Thumbnail Gallery */
    .thumbnail-container {
        position: relative;
    }

    .thumb-scroll-wrapper {
        position: relative;
        overflow: hidden;
    }

    .thumb-row {
        display: flex;
        gap: 12px;
        padding: 4px 2px 12px;
        overflow-x: auto;
        scroll-behavior: smooth;
        scrollbar-width: none;
        -ms-overflow-style: none;
        -webkit-overflow-scrolling: touch;
    }

    .thumb-row::-webkit-scrollbar {
        display: none;
        height: 0;
    }

    .thumb-scroll-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--bg-white);
        border: 1.5px solid var(--border-light);
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 20;
        transition: var(--transition);
        box-shadow: var(--shadow-md);
    }

    .thumb-scroll-btn:hover {
        background: var(--primary-green);
        border-color: var(--primary-green);
    }

    .thumb-scroll-btn:hover svg {
        stroke: white;
    }

    .thumb-scroll-left {
        left: 8px;
    }

    .thumb-scroll-right {
        right: 8px;
    }

    .thumb-scroll-btn svg {
        width: 16px;
        height: 16px;
        stroke: var(--text-dark);
        stroke-width: 2.5;
    }

    .thumb-row img {
        flex-shrink: 0;
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: var(--radius-md);
        cursor: pointer;
        border: 2px solid transparent;
        transition: var(--transition);
        background: var(--bg-white);
        padding: 4px;
    }

    .thumb-row img:hover {
        border-color: rgba(82, 183, 136, 0.3);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .thumb-row img.active {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 2px var(--primary-green), var(--shadow-sm);
        transform: scale(1.05);
    }

    .thumb-row img.error {
        display: none;
    }

    /* ===============================================
       PRODUCT INFO
       =============================================== */

    .product-info {
        animation: slideInRight 0.6s ease-out;
    }

    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* Badges */
    .badge-container {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 24px;
    }

    .stock-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border-radius: var(--radius-lg);
        font-size: 13px;
        font-weight: 700;
        letter-spacing: 0.02em;
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
    }

    .stock-ok { 
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #065f46;
        border: 1.5px solid #a7f3d0;
    }

    .stock-ok:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .stock-low { 
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        color: #92400e;
        border: 1.5px solid #fde68a;
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.02); }
    }

    .stock-out { 
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #991b1b;
        border: 1.5px solid #fecaca;
    }

    .feature-badge {
        background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
        color: #0369a1;
        border: 1.5px solid #bae6fd;
    }

    /* Price Section */
    .price-section {
        margin: 24px 0;
        padding: 24px;
        background: var(--bg-white);
        border-radius: var(--radius-xl);
        border: 1.5px solid var(--border-light);
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
    }

    .price-section:hover {
        box-shadow: var(--shadow-md);
        border-color: var(--primary-green-light);
    }

    .price-original {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-gray);
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 4px;
    }

    .price-original .strike {
        text-decoration: line-through;
    }

    .price-value {
        display: flex;
        align-items: baseline;
        gap: 12px;
        flex-wrap: wrap;
        margin: 8px 0;
    }

    .price-current {
        font-size: 40px;
        font-weight: 900;
        color: var(--text-dark);
        letter-spacing: -0.02em;
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1;
    }

    .price-discount {
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        color: white;
        padding: 6px 14px;
        border-radius: var(--radius-lg);
        font-size: 14px;
        font-weight: 800;
        box-shadow: var(--shadow-sm);
    }

    .tax-info {
        font-size: 14px;
        color: var(--text-gray);
        margin-top: 4px;
    }

    .delivery-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1.5px solid var(--border-light);
    }

    .delivery-info {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        background: #f0f9ff;
        border-radius: var(--radius-md);
        border: 1.5px solid #bae6fd;
    }

    .delivery-icon {
        width: 24px;
        height: 24px;
        flex-shrink: 0;
    }

    .delivery-text {
        font-size: 14px;
        color: var(--text-dark);
        font-weight: 500;
    }

    .delivery-text strong {
        color: var(--primary-green);
    }

    /* Description */
    .product-description {
        white-space: pre-wrap;
        line-height: 1.7;
        color: var(--text-medium);
        margin: 24px 0;
        font-size: 15px;
        padding: 24px;
        background: var(--bg-white);
        border-radius: var(--radius-xl);
        border: 1.5px solid var(--border-light);
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
    }

    .product-description:hover {
        box-shadow: var(--shadow-md);
        border-color: rgba(82, 183, 136, 0.2);
    }

    /* ===============================================
       BUTTONS
       =============================================== */

    .button-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin: 32px 0;
    }

    .btn-wrapper {
        text-decoration: none;
        display: block;
        width: 100%;
    }

    .btn {
        width: 100%;
        padding: 18px 24px;
        font-size: 16px;
        font-weight: 700;
        border-radius: var(--radius-lg);
        border: none;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        position: relative;
        overflow: hidden;
        z-index: 1;
        font-family: inherit;
    }

    .btn:focus-visible {
        outline: 3px solid var(--primary-blue);
        outline-offset: 2px;
    }

    .btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1), height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: -1;
    }

    .btn:active::before {
        width: 300px;
        height: 300px;
    }

    .btn-icon {
        font-size: 20px;
        transition: transform 0.3s ease;
    }

    .btn:hover .btn-icon {
        transform: scale(1.1);
    }

    .btn-cart { 
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        color: white;
        border: 1.5px solid var(--primary-green);
    }

    .btn-cart:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg), 0 8px 32px rgba(82, 183, 136, 0.25);
    }

    .btn-buy { 
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
        color: white;
        border: 1.5px solid var(--primary-blue);
    }

    .btn-buy:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg), 0 8px 32px rgba(37, 99, 235, 0.25);
    }

    .btn-disabled { 
        background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
        cursor: not-allowed;
        opacity: 0.7;
        border: 1.5px solid #9ca3af;
    }

    .btn-disabled:hover {
        transform: none;
        box-shadow: none;
    }

    /* ===============================================
       PRODUCT ACCORDION
       =============================================== */

    .product-accordion {
        margin: 32px 0;
        border-radius: var(--radius-xl);
        overflow: hidden;
        border: 1.5px solid var(--border-light);
        background: var(--bg-white);
        box-shadow: var(--shadow-sm);
    }

    .accordion-item + .accordion-item {
        border-top: 1.5px solid var(--border-light);
    }

    .accordion-header {
        width: 100%;
        background: var(--bg-white);
        border: none;
        padding: 20px 24px;
        font-size: 15px;
        font-weight: 700;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        text-align: left;
        transition: var(--transition);
        color: var(--text-dark);
    }

    .accordion-header:hover {
        background: #f8fafc;
    }

    .accordion-header:focus-visible {
        outline: 3px solid var(--primary-blue);
        outline-offset: -3px;
    }

    .accordion-icon {
        font-size: 18px;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        color: var(--text-gray);
    }

    .accordion-item.active .accordion-icon {
        transform: rotate(180deg);
        color: var(--primary-green);
    }

    .accordion-content {
        max-height: 0;
        overflow: hidden;
        padding: 0 24px;
        font-size: 15px;
        line-height: 1.7;
        color: var(--text-medium);
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: pre-wrap;
    }

    .accordion-item.active .accordion-content {
        max-height: 1000px;
        padding: 0 24px 24px;
    }

    /* ===============================================
       STICKY CTA BAR (MOBILE)
       =============================================== */

    .sticky-cta-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--bg-white);
        padding: 16px;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        transform: translateY(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: none;
        gap: 12px;
        border-top: 1px solid var(--border-light);
        backdrop-filter: blur(10px);
    }

    .sticky-cta-bar.visible {
        transform: translateY(0);
    }

    .sticky-cta-bar .btn {
        padding: 14px 16px;
        font-size: 15px;
        flex: 1;
    }

    .sticky-cta-bar .btn-icon {
        font-size: 18px;
    }

    /* ===============================================
       TABLET BREAKPOINT (768px+)
       =============================================== */

    @media (min-width: 768px) {
        .container {
            padding: 0 24px;
        }

        .product-header {
            margin: 32px 0 48px;
            padding: 0 0 32px;
        }

        .product-title {
            font-size: 36px;
        }

        .breadcrumb {
            font-size: 15px;
        }

        .brand-tag {
            font-size: 14px;
            padding: 10px 18px;
        }

        .rating-section {
            padding: 8px 16px;
        }

        .stars {
            font-size: 18px;
        }

        .rating-text {
            font-size: 16px;
        }

        .review-count {
            font-size: 15px;
        }

        .product-container { 
            grid-template-columns: 1fr 1fr;
            gap: 48px;
            margin-bottom: 64px;
        }
        
        .main-image-wrapper {
            border-radius: var(--radius-xl);
        }

        .main-image-container {
            aspect-ratio: 1 / 1;
        }

        .main-image {
            padding: 40px;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
        }

        .nav-arrow-left {
            left: 20px;
        }

        .nav-arrow-right {
            right: 20px;
        }

        .nav-arrow svg {
            width: 22px;
            height: 22px;
        }

        .image-counter {
            padding: 8px 20px;
            font-size: 14px;
            bottom: 20px;
        }

        .thumb-row img {
            width: 88px;
            height: 88px;
        }

        .thumb-scroll-btn {
            display: flex;
        }

        .price-section {
            padding: 28px;
            margin: 32px 0;
        }

        .price-original {
            font-size: 17px;
        }

        .price-current {
            font-size: 48px;
        }

        .price-discount {
            padding: 8px 16px;
            font-size: 15px;
        }

        .delivery-section {
            margin-top: 24px;
            padding-top: 24px;
        }

        .delivery-info {
            padding: 16px 20px;
        }

        .delivery-text {
            font-size: 15px;
        }

        .product-description {
            margin: 32px 0;
            font-size: 16px;
            padding: 28px;
        }

        .accordion-header {
            padding: 24px 28px;
            font-size: 16px;
        }

        .accordion-content {
            padding: 0 28px;
            font-size: 16px;
        }

        .accordion-item.active .accordion-content {
            padding: 0 28px 28px;
        }

        .button-group {
            flex-direction: row;
            gap: 16px;
            margin: 40px 0;
        }

        .btn-wrapper {
            flex: 1;
        }

        .btn {
            padding: 20px 32px;
            font-size: 17px;
        }

        .btn-icon {
            font-size: 22px;
        }

        .sticky-cta-bar {
            display: none;
        }
    }

    /* ===============================================
       DESKTOP BREAKPOINT (1024px+)
       =============================================== */

    @media (min-width: 1024px) {
        .product-header {
            margin: 40px 0 56px;
        }

        .product-title {
            font-size: 42px;
        }

        .brand-tag {
            font-size: 15px;
        }

        .rating-section:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .product-container { 
            gap: 64px;
        }

        .main-image-container:hover .nav-arrow {
            opacity: 1;
            transform: translateY(-50%) scale(1);
        }

        .nav-arrow {
            opacity: 0.8;
        }

        .nav-arrow:hover {
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }

        .thumb-row img {
            width: 96px;
            height: 96px;
        }

        .price-section {
            padding: 32px;
            box-shadow: var(--shadow-md);
        }

        .price-section:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .price-current {
            font-size: 52px;
        }

        .button-group .btn:hover {
            transform: translateY(-3px);
        }

        .btn-cart:hover {
            box-shadow: var(--shadow-xl), 0 12px 40px rgba(82, 183, 136, 0.3);
        }

        .btn-buy:hover {
            box-shadow: var(--shadow-xl), 0 12px 40px rgba(37, 99, 235, 0.3);
        }
    }

    /* ===============================================
       WIDE SCREENS (1440px+)
       =============================================== */

    @media (min-width: 1440px) {
        .product-container { 
            grid-template-columns: 1.2fr 0.8fr;
            gap: 80px;
        }

        .product-title {
            font-size: 48px;
        }

        .main-image-container {
            aspect-ratio: 1 / 1;
        }

        .main-image {
            padding: 48px;
        }

        .thumb-row img {
            width: 100px;
            height: 100px;
        }

        .price-current {
            font-size: 56px;
        }
    }

    /* ===============================================
       ACCESSIBILITY & REDUCED MOTION
       =============================================== */

    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
            scroll-behavior: auto !important;
        }
        
        .skeleton {
            animation: none;
            background: #f3f4f6;
        }
        
        .stock-low {
            animation: none;
        }
    }

    /* High contrast mode */
    @media (prefers-contrast: high) {
        .btn {
            border: 2px solid currentColor;
        }
        
        .stock-badge,
        .brand-tag,
        .rating-section {
            border: 2px solid currentColor;
        }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        :root {
            --text-dark: #f9fafb;
            --text-medium: #e5e7eb;
            --text-gray: #d1d5db;
            --text-light: #9ca3af;
            --border-light: #374151;
            --bg-light: #111827;
            --bg-white: #1f2937;
        }
        
        body {
            background: var(--bg-light);
        }
        
        .main-image-container {
            background: #2d3748;
        }
        
        .image-placeholder {
            background: #2d3748;
            color: var(--text-gray);
        }
        
        .delivery-info {
            background: #1e3a8a;
            border-color: #3b82f6;
        }
        
        .accordion-header:hover {
            background: #374151;
        }
    }
</style>

<div class="container">
    <!-- HEADER -->
    <div class="product-header">
        <div class="breadcrumb">
            <a href="{{ url_for('main.home') }}" aria-label="Home">Home</a>
            <span class="separator">‚Ä∫</span>
            <a href="{{ url_for('main.shop') }}" aria-label="Shop">Shop</a>
            <span class="separator">‚Ä∫</span>
            <span>{{ product.category or 'Product' }}</span>
        </div>
        
        <div class="product-title-wrapper">
            <h1 class="product-title">{{ product.name }}</h1>
            <button class="wishlist-btn" id="wishlistBtn" aria-label="Add to wishlist">
                <svg viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
            </button>
        </div>

        <div class="product-meta">
            <div class="brand-tag">üåø Ayurvedic ¬∑ Premium Quality</div>
            
            <div class="rating-section">
                <div class="stars" style="--rating: {{ (product.rating or 0) / 5 * 100 }}%">
                    <span class="stars-inner">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                </div>
                <span class="rating-text">{{ "%.1f"|format(product.rating or 0) }}</span>
                <a href="#reviews" class="review-count" aria-label="View reviews">
                    ({{ product.rating_count or 0 }} reviews)
                </a>
            </div>
        </div>
    </div>

    <div class="product-container">
        <!-- IMAGE GALLERY -->
        <div class="image-gallery">
            <div class="main-image-wrapper">
                <div class="main-image-container" id="mainImageContainer">
                    {% if product.images and product.images|length > 0 %}
                        <img id="mainImage"
                             src="{{ url_for('static', filename='images/' ~ product.images[0]) }}"
                             class="main-image"
                             alt="{{ product.name }}"
                             loading="lazy"
                             onerror="handleImageError(this)">
                    {% else %}
                        <div class="image-placeholder">
                            <div>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <polyline points="21 15 16 10 5 21"/>
                                </svg>
                                <p>No image available</p>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Navigation Arrows -->
                    <button class="nav-arrow nav-arrow-left" 
                            id="prevBtn" 
                            aria-label="Previous image">
                        <svg viewBox="0 0 24 24">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>

                    <button class="nav-arrow nav-arrow-right" 
                            id="nextBtn" 
                            aria-label="Next image">
                        <svg viewBox="0 0 24 24">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>

                    <!-- Image Counter -->
                    <div class="image-counter" id="imageCounter">
                        1 / {{ product.images|length if product.images else 1 }}
                    </div>
                </div>
            </div>

            <!-- Thumbnails -->
            <div class="thumbnail-container">
                <div class="thumb-scroll-wrapper">
                    <button class="thumb-scroll-btn thumb-scroll-left" aria-label="Scroll thumbnails left">
                        <svg viewBox="0 0 24 24">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    
                    <div class="thumb-row" id="thumbRow">
                        {% if product.images and product.images|length > 0 %}
                            {% for img in product.images %}
                                <img src="{{ url_for('static', filename='images/' ~ img) }}"
                                     class="{% if loop.index0 == 0 %}active{% endif %}"
                                     data-index="{{ loop.index0 }}"
                                     alt="Product view {{ loop.index }}"
                                     loading="lazy"
                                     onerror="handleThumbnailError(this)">
                            {% endfor %}
                        {% else %}
                            <img src="{{ url_for('static', filename='images/default.png') }}"
                                 class="active"
                                 data-index="0"
                                 alt="Default product image">
                        {% endif %}
                    </div>
                    
                    <button class="thumb-scroll-btn thumb-scroll-right" aria-label="Scroll thumbnails right">
                        <svg viewBox="0 0 24 24">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PRODUCT INFO -->
        <div class="product-info">
            <!-- Badges -->
            <div class="badge-container">
                {% if product.stock == 0 %}
                    <span class="stock-badge stock-out">‚ùå Out of Stock</span>
                {% elif product.stock <= 3 %}
                    <span class="stock-badge stock-low">‚ö†Ô∏è Only {{ product.stock }} left</span>
                {% else %}
                    <span class="stock-badge stock-ok">‚úÖ In Stock ({{ product.stock }} available)</span>
                {% endif %}

                {% if product.badges %}
                    {% for badge in product.badges %}
                        <span class="stock-badge feature-badge">üèÜ {{ badge }}</span>
                    {% endfor %}
                {% endif %}
                
                {% if product.is_featured %}
                    <span class="stock-badge feature-badge">‚≠ê Featured</span>
                {% endif %}
            </div>

            <!-- Price -->
            <div class="price-section">
                {% if product.mrp and product.mrp > product.price %}
                    <div class="price-original">
                        <span class="strike">MRP: ‚Çπ{{ product.mrp }}</span>
                        <span class="price-discount">
                            {{ ((product.mrp - product.price) / product.mrp * 100)|round|int }}% OFF
                        </span>
                    </div>
                    <div class="price-value">
                        <span class="price-current">‚Çπ{{ product.price }}</span>
                    </div>
                    <div class="tax-info">Inclusive of all taxes</div>
                {% else %}
                    <div class="price-value">
                        <span class="price-current">‚Çπ{{ product.price }}</span>
                    </div>
                    <div class="tax-info">Inclusive of all taxes</div>
                {% endif %}

                <div class="delivery-section">
                    <div class="delivery-info">
                        <div class="delivery-icon">üöö</div>
                        <div class="delivery-text">
                            <strong>Free delivery</strong> in {{ product.delivery_days or '3-5' }} days
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Details Accordion -->
            <div class="product-accordion" id="productAccordion">
                <div class="accordion-item active">
                    <button class="accordion-header" aria-expanded="true">
                        Product Description
                        <span class="accordion-icon">‚åÑ</span>
                    </button>
                    <div class="accordion-content">
                        {{ product.description or 'No description available.' }}
                    </div>
                </div>

                {% if product.ingredients %}
                <div class="accordion-item">
                    <button class="accordion-header" aria-expanded="false">
                        Ingredients
                        <span class="accordion-icon">‚åÑ</span>
                    </button>
                    <div class="accordion-content">
                        {{ product.ingredients }}
                    </div>
                </div>
                {% endif %}

                {% if product.nutrition %}
                <div class="accordion-item">
                    <button class="accordion-header" aria-expanded="false">
                        Nutrition Facts
                        <span class="accordion-icon">‚åÑ</span>
                    </button>
                    <div class="accordion-content">
                        {{ product.nutrition }}
                    </div>
                </div>
                {% endif %}

                {% if product.dosage %}
                <div class="accordion-item">
                    <button class="accordion-header" aria-expanded="false">
                        Usage & Dosage
                        <span class="accordion-icon">‚åÑ</span>
                    </button>
                    <div class="accordion-content">
                        {{ product.dosage }}
                    </div>
                </div>
                {% endif %}

                {% if product.additional_info %}
                <div class="accordion-item">
                    <button class="accordion-header" aria-expanded="false">
                        Additional Information
                        <span class="accordion-icon">‚åÑ</span>
                    </button>
                    <div class="accordion-content">
                        {{ product.additional_info }}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Buttons -->
            <div class="button-group">
                {% if product.stock == 0 %}
                    <button class="btn btn-cart btn-disabled" disabled aria-label="Out of stock">
                        <span class="btn-icon">üõí</span>
                        <span>Out of Stock</span>
                    </button>
                    <button class="btn btn-buy btn-disabled" disabled aria-label="Notify when available">
                        <span class="btn-icon">üîî</span>
                        <span>Notify Me</span>
                    </button>
                {% else %}
                    <a href="{{ url_for('main.add_to_cart', product_id=product.id) }}" class="btn-wrapper" id="addToCartBtn">
                        <button class="btn btn-cart" aria-label="Add to cart">
                            <span class="btn-icon">üõí</span>
                            <span>Add to Cart</span>
                        </button>
                    </a>
                    <a href="{{ url_for('main.buy_now', product_id=product.id) }}" class="btn-wrapper" id="buyNowBtn">
                        <button class="btn btn-buy" aria-label="Buy now">
                            <span class="btn-icon">‚ö°</span>
                            <span>Buy Now</span>
                        </button>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Sticky CTA Bar for Mobile -->
<div class="sticky-cta-bar" id="stickyCtaBar">
    {% if product.stock == 0 %}
        <button class="btn btn-cart btn-disabled" disabled>Out of Stock</button>
    {% else %}
        <a href="{{ url_for('main.add_to_cart', product_id=product.id) }}" class="btn-wrapper">
            <button class="btn btn-cart">
                <span class="btn-icon">üõí</span>
                <span>Add to Cart</span>
            </button>
        </a>
        <a href="{{ url_for('main.buy_now', product_id=product.id) }}" class="btn-wrapper">
            <button class="btn btn-buy">
                <span class="btn-icon">‚ö°</span>
                <span>Buy Now</span>
            </button>
        </a>
    {% endif %}
</div>

<script>
    // Product data
    const productData = {
        id: '{{ product.id }}',
        name: '{{ product.name | tojson | safe }}',
        price: {{ product.price }},
        stock: {{ product.stock }},
        images: {{ (product.images or []) | tojson | safe }},
        rating: {{ product.rating or 0 }}
    };

    // Image gallery state
    let currentImageIndex = 0;
    let totalImages = 0;
    let images = [];

    // DOM elements cache
    let mainImage, imageCounter, prevBtn, nextBtn, thumbRow, thumbScrollLeft, thumbScrollRight;

    // Initialize gallery
    function initGallery() {
        mainImage = document.getElementById('mainImage');
        imageCounter = document.getElementById('imageCounter');
        prevBtn = document.getElementById('prevBtn');
        nextBtn = document.getElementById('nextBtn');
        thumbRow = document.getElementById('thumbRow');
        thumbScrollLeft = document.querySelector('.thumb-scroll-left');
        thumbScrollRight = document.querySelector('.thumb-scroll-right');

        // Get all valid thumbnails
        images = Array.from(document.querySelectorAll('.thumb-row img')).filter(img => {
            return img.complete && img.naturalWidth > 0 && !img.classList.contains('error');
        });

        totalImages = Math.max(images.length, 1);
        
        if (images.length === 0 && mainImage) {
            // Create a default image element if none exist
            const defaultImg = document.createElement('img');
            defaultImg.src = '{{ url_for("static", filename="images/default.png") }}';
            defaultImg.className = 'active';
            defaultImg.dataset.index = '0';
            defaultImg.alt = 'Default product image';
            images = [defaultImg];
            totalImages = 1;
        }

        // Initialize counters and buttons
        updateImageCounter();
        updateNavigationButtons();
        setupEventListeners();
        
        // Show thumbnail scroll buttons if needed
        updateThumbScrollButtons();
    }

    // Setup event listeners
    function setupEventListeners() {
        // Thumbnail click
        images.forEach(img => {
            img.addEventListener('click', () => changeImage(img.dataset.index));
            img.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    changeImage(img.dataset.index);
                }
            });
        });

        // Navigation buttons
        if (prevBtn) {
            prevBtn.addEventListener('click', () => navigateImage(-1));
        }
        
        if (nextBtn) {
            nextBtn.addEventListener('click', () => navigateImage(1));
        }

        // Keyboard navigation
        document.addEventListener('keydown', handleKeyNavigation);

        // Touch swipe
        const mainImageContainer = document.getElementById('mainImageContainer');
        if (mainImageContainer) {
            let touchStartX = 0;
            let touchEndX = 0;

            mainImageContainer.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            mainImageContainer.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe(touchStartX, touchEndX);
            }, { passive: true });
        }

        // Image zoom
        if (mainImage) {
            mainImage.addEventListener('click', toggleZoom);
        }

        // Thumbnail scrolling
        if (thumbScrollLeft) {
            thumbScrollLeft.addEventListener('click', () => scrollThumbs(-100));
        }
        
        if (thumbScrollRight) {
            thumbScrollRight.addEventListener('click', () => scrollThumbs(100));
        }

        // Accordion
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', toggleAccordion);
            header.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleAccordion(e);
                }
            });
        });

        // Wishlist button
        const wishlistBtn = document.getElementById('wishlistBtn');
        if (wishlistBtn) {
            wishlistBtn.addEventListener('click', toggleWishlist);
        }

        // Sticky CTA bar
        window.addEventListener('scroll', updateStickyCtaBar);
        updateStickyCtaBar();
    }

    // Change image
    function changeImage(index) {
        index = parseInt(index);
        if (isNaN(index) || index < 0 || index >= totalImages || index === currentImageIndex) return;

        currentImageIndex = index;
        
        if (mainImage && images[index]) {
            // Add transition effect
            mainImage.style.opacity = '0';
            
            setTimeout(() => {
                mainImage.src = images[index].src;
                mainImage.alt = images[index].alt;
                mainImage.style.opacity = '1';
            }, 150);
            
            // Remove zoom if active
            mainImage.classList.remove('zoomed');
        }

        // Update active thumbnail
        images.forEach((img, i) => {
            img.classList.toggle('active', i === index);
        });

        // Scroll thumbnail into view
        if (images[index] && thumbRow) {
            images[index].scrollIntoView({
                behavior: 'smooth',
                block: 'nearest',
                inline: 'center'
            });
        }

        updateImageCounter();
        updateNavigationButtons();
    }

    // Navigate between images
    function navigateImage(direction) {
        const newIndex = currentImageIndex + direction;
        if (newIndex >= 0 && newIndex < totalImages) {
            changeImage(newIndex);
        }
    }

    // Update image counter
    function updateImageCounter() {
        if (imageCounter) {
            imageCounter.textContent = `${currentImageIndex + 1} / ${totalImages}`;
        }
    }

    // Update navigation button states
    function updateNavigationButtons() {
        if (prevBtn) {
            prevBtn.classList.toggle('disabled', currentImageIndex === 0);
            prevBtn.setAttribute('aria-disabled', currentImageIndex === 0);
        }
        
        if (nextBtn) {
            nextBtn.classList.toggle('disabled', currentImageIndex === totalImages - 1);
            nextBtn.setAttribute('aria-disabled', currentImageIndex === totalImages - 1);
        }
    }

    // Update thumbnail scroll buttons
    function updateThumbScrollButtons() {
        if (!thumbRow || !thumbScrollLeft || !thumbScrollRight) return;
        
        const showLeft = thumbRow.scrollLeft > 0;
        const showRight = thumbRow.scrollLeft < (thumbRow.scrollWidth - thumbRow.clientWidth - 10);
        
        thumbScrollLeft.style.display = showLeft ? 'flex' : 'none';
        thumbScrollRight.style.display = showRight ? 'flex' : 'none';
    }

    // Scroll thumbnails
    function scrollThumbs(amount) {
        if (thumbRow) {
            thumbRow.scrollBy({ left: amount, behavior: 'smooth' });
            setTimeout(updateThumbScrollButtons, 300);
        }
    }

    // Handle keyboard navigation
    function handleKeyNavigation(e) {
        if (e.key === 'ArrowLeft') {
            e.preventDefault();
            navigateImage(-1);
        } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            navigateImage(1);
        }
    }

    // Handle touch swipe
    function handleSwipe(startX, endX) {
        const swipeThreshold = 50;
        const diff = startX - endX;

        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
                // Swipe left - next image
                navigateImage(1);
            } else {
                // Swipe right - previous image
                navigateImage(-1);
            }
        }
    }

    // Toggle image zoom
    function toggleZoom() {
        if (mainImage) {
            mainImage.classList.toggle('zoomed');
        }
    }

    // Toggle accordion
    function toggleAccordion(e) {
        const header = e.currentTarget;
        const item = header.parentElement;
        const isActive = item.classList.contains('active');
        
        // Close all other accordion items
        document.querySelectorAll('.accordion-item').forEach(otherItem => {
            if (otherItem !== item) {
                otherItem.classList.remove('active');
                otherItem.querySelector('.accordion-header').setAttribute('aria-expanded', 'false');
            }
        });
        
        // Toggle current item
        item.classList.toggle('active');
        header.setAttribute('aria-expanded', !isActive);
    }

    // Toggle wishlist
    function toggleWishlist() {
        const btn = document.getElementById('wishlistBtn');
        if (btn) {
            btn.classList.toggle('active');
            const isActive = btn.classList.contains('active');
            
            // Update aria-label
            btn.setAttribute('aria-label', isActive ? 'Remove from wishlist' : 'Add to wishlist');
            
            // Show feedback
            showToast(isActive ? 'Added to wishlist' : 'Removed from wishlist');
        }
    }

    // Update sticky CTA bar
    function updateStickyCtaBar() {
        const ctaBar = document.getElementById('stickyCtaBar');
        if (!ctaBar) return;
        
        const isMobile = window.innerWidth < 768;
        const scrollPosition = window.scrollY + window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        
        if (isMobile && scrollPosition < documentHeight - 100) {
            ctaBar.style.display = 'flex';
            setTimeout(() => ctaBar.classList.add('visible'), 10);
        } else {
            ctaBar.classList.remove('visible');
            setTimeout(() => {
                if (!ctaBar.classList.contains('visible')) {
                    ctaBar.style.display = 'none';
                }
            }, 300);
        }
    }

    // Handle image loading errors
    function handleImageError(img) {
        console.warn('Main image failed to load:', img.src);
        img.src = '{{ url_for("static", filename="images/default.png") }}';
        img.onerror = null; // Prevent infinite loop
    }

    function handleThumbnailError(img) {
        console.warn('Thumbnail failed to load:', img.src);
        img.classList.add('error');
        img.style.display = 'none';
        
        // Update gallery if this was the active thumbnail
        if (img.classList.contains('active')) {
            const nextValid = document.querySelector('.thumb-row img:not(.error)');
            if (nextValid) {
                changeImage(nextValid.dataset.index);
            }
        }
        
        // Reinitialize gallery
        setTimeout(initGallery, 100);
    }

    // Show toast notification
    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'toast-notification';
        toast.textContent = message;
        toast.style.cssText = `
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--primary-green);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-lg);
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
        `;
        
        document.body.appendChild(toast);
        
        // Animate in
        setTimeout(() => {
            toast.style.opacity = '1';
            toast.style.transform = 'translateX(-50%) translateY(0)';
        }, 10);
        
        // Remove after delay
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(-50%) translateY(-20px)';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        initGallery();
        
        // Add thumbnail scroll listener
        if (thumbRow) {
            thumbRow.addEventListener('scroll', updateThumbScrollButtons);
        }
        
        // Add resize listener for sticky CTA
        window.addEventListener('resize', updateStickyCtaBar);
        
        // Set initial rating star width
        const stars = document.querySelector('.stars');
        if (stars) {
            const rating = parseFloat('{{ product.rating or 0 }}');
            const width = Math.min(100, (rating / 5) * 100);
            stars.style.setProperty('--rating', `${width}%`);
        }
    });

    // Prevent default behavior for disabled buttons
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('btn-disabled') || 
            e.target.closest('.btn-disabled')) {
            e.preventDefault();
            e.stopPropagation();
        }
    });
</script>

{% endblock %}